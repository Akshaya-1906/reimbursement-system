<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="navbar">
    <div class="title">Student Bill Portal</div>
    <a href="/logout">Logout</a>
</div>

<div class="container">
<div class="card">
<div class="card-header">Admin Dashboard</div>

<form method="post">
<div style="
    display:flex;
    justify-content:flex-end;
    margin-bottom:15px;
">
    <span style="
        background:#e6f7ea;
        color:#1e7e34;
        padding:6px 14px;
        border-radius:20px;
        font-weight:600;
        font-size:14px;
    ">
        âœ… Approved Requests: {{ approved_count }}
    </span>
</div>

<table class="admin-table">
<tr>
    <th>Generate Letter</th>
    <th>ID</th>
    <th>Student</th>
    <th>Status</th>
    <th>Action</th>
    <th>Delete Request</th>
</tr>

{% for r in data %}
<tr>
    <!-- Generate Letter checkbox (ONLY APPROVED) -->
    <td>
        {% if r[5] == "APPROVED" %}
            <input type="checkbox" name="request_ids" value="{{ r[0] }}">
        {% endif %}
    </td>

    <td>{{ r[0] }}</td>
    <td>{{ r[1] }}</td>

    <td>
        {% if r[5] == "APPROVED" %}
            <span class="status-approved">APPROVED</span>
        {% elif r[5] == "DISAPPROVED" %}
            <span class="status-disapproved">DISAPPROVED</span>
        {% else %}
            <span class="status-pending">PENDING</span>
        {% endif %}
    </td>

    <td>
        <div style="margin-bottom:8px;">
            <a href="/admin/request/{{ r[0] }}" class="btn btn-primary">View</a>
        </div>
        <div style="display:flex; gap:8px;">
            <a href="/update/{{ r[0] }}/APPROVED" class="btn btn-success">Approve</a>
            <a href="/update/{{ r[0] }}/DISAPPROVED" class="btn btn-danger">Disapprove</a>
        </div>
    </td>

    <!-- Delete checkbox (ALL REQUESTS) -->
    <td>
        <input type="checkbox" name="delete_ids" value="{{ r[0] }}">
    </td>
</tr>
{% endfor %}
</table>

<hr style="margin:25px 0;">

<!-- BULK DOWNLOAD -->
<a href="/admin/download-approved-bills" class="btn btn-primary">
    Download All Approved Bills (PDF)
</a>

<a href="/admin/download-approved-passbooks" class="btn btn-success">
    Download All Approved Passbooks (PDF)
</a>
<button formaction="/admin/delete-selected"
        formmethod="post"
        formnovalidate
        class="btn btn-danger"
        style="float:right;">
    Delete Selected
</button>

<hr style="margin:25px 0;">

<!-- GENERATE LETTER -->
<h3>Generate Official Letter</h3>

<label>Subject</label>
<input type="text" name="subject"
       placeholder="Enter subject here"
       required>

<label>Date</label>
<input type="date" name="letter_date" required>

<br><br>
<button formaction="/admin/generate-letter"
        formmethod="post"
        class="btn btn-primary">
    Generate Letter
</button>

<!-- DELETE SELECTED -->


</form>

</div>
</div>

</body>
</html>
